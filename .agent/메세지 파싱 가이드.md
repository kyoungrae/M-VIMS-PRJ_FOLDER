# 메세지 파싱 및 국제화(i18n) 가이드

이 문서는 시스템의 메세지 파싱 과정과 다국어(한국어, 영어, 몽골어) 적용 방법을 설명합니다.

## 1. 메세지 파일 구조 및 포맷

### 파일 위치
메세지 파일은 언어별로 디렉토리가 구분되어 관리됩니다.
- **한국어**: `/vims-login/src/main/resources/static/common/js/message/ko/`
- **영어**: `/vims-login/src/main/resources/static/common/js/message/en/`
- **몽골어**: `/vims-login/src/main/resources/static/common/js/message/mn/`
- **공통 메세지**: `/vims-login/src/main/resources/static/common/js/common/` (`Message.js`, `Message.en.js`, `Message.mn.js`)

### 메세지 포맷
모든 JavaScript 메세지 파일은 아래와 같은 형식을 유지해야 합니다.
```javascript
Message.Label.Array["KEY"] = "Value";
```
이 형식은 서버(`MessageService.java`)와 클라이언트(`Common.js`)에서 공통으로 파싱하는 기준이 됩니다.

## 2. 서버 사이드 (Java - MessageService.java)

### 작동 방식
1. **초기화**: `@PostConstruct`를 통해 서버 기동 시 `init()` 메서드가 실행되어 `ko`, `en`, `mn` 메세지를 로드합니다.
2. **리소스 탐색**: `classpath*:/static/common/js/message/**/*.js` 경로를 탐색하여 메세지 파일 목록을 생성합니다. 이때 하위 디렉토리(management, login 등)의 경로 구조를 유지하여 저장합니다.
3. **로컬라이징 경로 처리**: 선택된 언어(locale)에 따라 파일 경로를 동적으로 구성합니다.
    - 공통 메세지: `Message.js` (ko) 또는 `Message.{locale}.js` (en, mn)
    - 페이지 메세지: `{locale}/management/FileName.js` 형태로 로드합니다.
4. **Gateway 연동**: 로컬 리소스에서 파일을 찾지 못할 경우 `gatewayUrl`을 통해 외부 서버에서 메세지 파일을 가져옵니다.
5. **파싱 및 캐시**: 파일 내용을 정규표현식으로 읽어 `messageCache` (Map)에 저장합니다.

## 3. 클라이언트 사이드 (JavaScript)

### 언어 선택 및 저장
- 사용자가 화면의 언어 선택기(지구본 아이콘)에서 언어를 선택하면 `localStorage.setItem("selectedLanguage", "en")`과 같이 브라우저에 저장됩니다.
- 변경 후 `location.reload()`를 통해 페이지를 새로고침하여 설정을 반영합니다.

### 동적 스크립트 로딩 (messageConfig.js)
`loadToScript` 클래스가 페이지 로드 시 실행되어 다음 작업을 수행합니다.
1. `localStorage`에서 선택된 언어를 확인합니다 (기본값: `ko`).
2. 해당 언어에 맞는 공통 메세지 파일과 페이지별 메세지 파일들을 순차적으로 로드합니다.
3. **로드 완료 동기화**: 모든 메세지 스크립트가 로드된 후 `onload` 이벤트를 통해 `PageInit.messageLabelSettings()`를 트리거하여 화면을 번역합니다.

### DOM 메세지 치환 (Common.js - PageInit)
HTML 템플릿에 작성된 특수 패턴을 실제 메세지로 치환합니다.
- **치환 패턴**: `[Page.Message].Message.Label.Array["KEY_NAME"]`
- **치환 범위**: 텍스트 노드, 버튼의 `value`, Input의 `placeholder` 등

## 4. 새로운 메세지 추가 방법
1. `/message/ko/` 하위의 적절한 폴더에 새로운 키와 한국어 메세지를 추가합니다.
2. 동일한 키로 `/message/en/` 및 `/message/mn/` 폴더 내 동일 경로의 파일에도 번역문을 추가합니다.
3. HTML 템플릿에서 `[Page.Message].Message.Label.Array["신규_키"]` 형태로 사용합니다.

## 5. 주의 사항
- **경로 일관성**: 서버와 클라이언트가 동일한 폴더 구조(`en/management/...`)를 사용하므로 파일 생성 시 경로가 정확한지 확인하십시오.
- **특수 문자 처리**: 메세지 값 내부에 쌍따옴표(`"`)가 있을 경우 파싱 오류를 방지하기 위해 주의해서 작성하십시오.
- **빌드 후 확인**: 서버 측 로직 수정을 확인하려면 `./deploy-core-lib.sh` 등을 통해 빌드 후 재기동이 필요합니다.
