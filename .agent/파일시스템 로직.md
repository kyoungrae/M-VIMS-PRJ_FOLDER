# ğŸ“ FMS (File Management System) ìƒì„¸ ë¡œì§ ê°€ì´ë“œ

ë³¸ ë¬¸ì„œëŠ” VIMS ì‹œìŠ¤í…œì—ì„œ íŒŒì¼ì˜ ì—…ë¡œë“œ, ê´€ë¦¬, ì¡°íšŒ ë° ë‹¤ìš´ë¡œë“œê°€ ì´ë£¨ì–´ì§€ëŠ” ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ ê¸°ìˆ ì ì¸ ì¸¡ë©´ì—ì„œ ì•„ì£¼ ìƒì„¸í•˜ê²Œ ì„¤ëª…í•©ë‹ˆë‹¤. ë…í•™ì„ ëª©ì ìœ¼ë¡œ í•˜ì‹œëŠ” ë§Œí¼, ë°ì´í„°ê°€ íë¥´ëŠ” ìˆœì„œì™€ ê° ì»´í¬ë„ŒíŠ¸ì˜ ì—­í• ì„ ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ—ï¸ 1. ì „ì²´ ì•„í‚¤í…ì²˜ (Architecture)

ìš°ë¦¬ ì‹œìŠ¤í…œì˜ íŒŒì¼ ë¡œì§ì€ í¬ê²Œ 3ë‹¨ê³„ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

1.  **Frontend (UI)**: `FileUtils.js`ì—ì„œ HTML ì†ì„±(`data-file-card`)ì„ ê°ì§€í•˜ì—¬ UIë¥¼ ê·¸ë¦¬ê³  ì´ë²¤íŠ¸ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
2.  **API Gateway**: ì‚¬ìš©ìì˜ ìš”ì²­ì„ FMS ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
3.  **Backend (FMS Project)**: ì‹¤ì œ íŒŒì¼ì„ ì €ì¥ ì¥ì¹˜ì— ë¬¼ë¦¬ì ìœ¼ë¡œ ì“°ê³ , ë°ì´í„°ë² ì´ìŠ¤(MariaDB)ì— ê·¸ ì •ë³´ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.

---

## ğŸ› ï¸ 2. í”„ë¡ íŠ¸ì—”ë“œ (Frontend) - Zero-Code ë°©ì‹

### 2.1 ìë™ ì´ˆê¸°í™” ë¡œì§
ì‚¬ìš©ìê°€ HTMLì— `<div data-file-card ...></div>`ë¥¼ ì‘ì„±í•˜ë©´ ë‹¤ìŒ ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.

1.  **`PageInit`**: ëª¨ë“  í˜ì´ì§€ ë¡œë“œ ì‹œ `fileUtil.initFileCards()`ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
2.  **`initFileCards`**: `[data-file-card]` ì†ì„±ì„ ê°€ì§„ ëª¨ë“  ìš”ì†Œë¥¼ ì°¾ì•„ ì˜µì…˜(inputId, folderName ë“±)ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
3.  **`loadFileCard`**: 
    *   `/common/file` í…œí”Œë¦¿(HTML)ì„ ë¹„ë™ê¸°ë¡œ ë¡œë“œí•˜ì—¬ í•´ë‹¹ `div`ì— ì‚½ì…í•©ë‹ˆë‹¤.
    *   `isReadOnly` ì˜µì…˜ì— ë”°ë¼ "ì—…ë¡œë“œ ë²„íŠ¼" ë…¸ì¶œ ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.
    *   ì§€ì •ëœ `input` ìš”ì†Œì— `change` ì´ë²¤íŠ¸ë¥¼ ë°”ì¸ë”©í•˜ì—¬, UUIDê°€ ë“¤ì–´ì˜¤ë©´ ìë™ìœ¼ë¡œ ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.

### 2.2 ì—…ë¡œë“œ ì—”ì§„ (`createFileUploadHTML`)
"ì—…ë¡œë“œ ì‹œì‘" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ íŒì—…ì´ ëœ¨ê³ , ì‚¬ìš©ìê°€ íŒŒì¼ì„ ë“œëí•˜ë©´ ë‹¤ìŒ ì¼ì´ ë²Œì–´ì§‘ë‹ˆë‹¤.
- **íŒŒì¼ ê²€ì¦**: í™•ì¥ì, ìš©ëŸ‰ ë“±ì„ ì²´í¬í•©ë‹ˆë‹¤.
- **ë©€í‹°íŒŒíŠ¸ ì „ì†¡**: `FormData` ê°ì²´ì— íŒŒì¼ì„ ë‹´ì•„ `axios`ë¥¼ í†µí•´ FMSì˜ `/fms/fileManager/upload`ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
- **UUID ë°˜í™˜**: ì„œë²„ì—ì„œ ìƒì„±ì´ ì™„ë£Œë˜ë©´ ê³ ìœ í•œ `file_uuid`ë¥¼ ë°›ì•„ JSì˜ Input í•„ë“œì— ìë™ìœ¼ë¡œ ì±„ì›ë‹ˆë‹¤.

---

## ğŸ–¥ï¸ 3. ë°±ì—”ë“œ (Backend - FMS)

### 3.1 íŒŒì¼ ì €ì¥ í”„ë¡œì„¸ìŠ¤ (`FileManagerService.java`)
ì‚¬ìš©ìê°€ íŒŒì¼ì„ ì „ì†¡í•˜ë©´ ì„œë²„ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤.

1.  **UUID ê´€ë¦¬**:
    *   í´ë¼ì´ì–¸íŠ¸ê°€ `file_uuid`ë¥¼ ë³´ë‚´ì˜¤ë©´(ìˆ˜ì • ì‹œ) í•´ë‹¹ ê°’ì„ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.
    *   ì—†ìœ¼ë©´(ì‹ ê·œ ë“±ë¡ ì‹œ) `UUID.randomUUID()`ë¡œ ìƒˆë¡œìš´ ê³ ìœ  ì‹ë³„ìë¥¼ ë§Œë“­ë‹ˆë‹¤.
2.  **ë¬¼ë¦¬ ì €ì¥ (`FileProcessManager.uploadFile`)**:
    *   ì„¤ì • íŒŒì¼(`application.yml`)ì— ì •ì˜ëœ ê²½ë¡œ(`common.file.directory.path`)ì— í´ë”ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    *   íŒŒì¼ëª… ì¶©ëŒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì‚¬ìš©ìê°€ ì˜¬ë¦° íŒŒì¼ëª… ëŒ€ì‹  **`randomUUID.í™•ì¥ì`** í˜•íƒœë¡œ ì €ì¥í•©ë‹ˆë‹¤.
3.  **ë©”íƒ€ë°ì´í„° ê¸°ë¡**:
    *   `SYS_FILE`: íŒŒì¼ ë¬¶ìŒ(UUID) ë‹¨ìœ„ì˜ ë§ˆìŠ¤í„° ë ˆì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    *   `SYS_FILE_DETAIL`: ê° ê°œë³„ íŒŒì¼ì˜ ë¬¼ë¦¬ ê²½ë¡œ, ì›ë³¸ ëª…ì¹­, í¬ê¸° ë“±ì„ ê¸°ë¡í•©ë‹ˆë‹¤.

### 3.2 ë‹¤ìš´ë¡œë“œ ë¡œì§ (`FileManagerController.download`)
ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì‹œ (`GET /fms/fileManager/download?fileId=...`) íë¦„ì…ë‹ˆë‹¤.

1.  **ì •ë³´ ì¡°íšŒ**: `file_id`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ `SYS_FILE_DETAIL` í…Œì´ë¸”ì—ì„œ ë¬¼ë¦¬ ê²½ë¡œì™€ íŒŒì¼ëª…ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
2.  **ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬**: 
    *   `FileInputStream`ìœ¼ë¡œ ì„œë²„ í•˜ë“œë””ìŠ¤í¬ì˜ íŒŒì¼ì„ ì½ìŠµë‹ˆë‹¤.
    *   ë¸Œë¼ìš°ì €ê°€ íŒŒì¼ì„ ë‚´ë ¤ë°›ë„ë¡ `Content-Disposition: attachment;` í—¤ë”ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    *   **íŒŒì¼ëª… ì¸ì½”ë”©**: í•œê¸€ íŒŒì¼ëª… ê¹¨ì§ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ `URLEncoder.encode`ë¡œ UTF-8 ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
    *   `StreamUtils.copy`ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ë°ì´í„°ë¥¼ ì‘ë‹µ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ìŸì•„ëƒ…ë‹ˆë‹¤.

---

## ğŸ’¾ 4. ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° (Database)

| í…Œì´ë¸”ëª… | ì—­í•  | ì£¼ìš” ì»¬ëŸ¼ |
| :--- | :--- | :--- |
| **`SYS_FILE`** | íŒŒì¼ ê·¸ë£¹ ê´€ë¦¬ì | `file_uuid` (PK), `temp_yn` (ì„ì‹œì €ì¥ ì—¬ë¶€) |
| **`SYS_FILE_DETAIL`** | ê°œë³„ íŒŒì¼ ìƒì„¸ ì •ë³´ | `file_id` (PK), `file_uuid` (FK), `file_path`, `file_name` (ì›ë³¸ëª…) |

- **ì™œ ë‘ í…Œì´ë¸”ë¡œ ë‚˜ë‰˜ë‚˜ìš”?**
  - ê²Œì‹œê¸€ í•˜ë‚˜ì— ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ì´ ì²¨ë¶€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
  - ê²Œì‹œê¸€ í…Œì´ë¸”ì€ `file_uuid` í•˜ë‚˜ë§Œ ë“¤ê³  ìˆê³ , ì‹¤ì œ ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ì€ `SYS_FILE_DETAIL`ì—ì„œ `file_uuid`ë¡œ ì—®ì—¬ ê´€ë¦¬ë˜ëŠ” **1:N êµ¬ì¡°**ì…ë‹ˆë‹¤.

---

## ğŸ”„ 5. ì „ì²´ ë°ì´í„° íë¦„ë„ (Data Flow)

1.  **ì‚¬ìš©ì**: íŒŒì¼ ì„ íƒ ë° ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­
2.  **Front**: `FormData` ìƒì„± -> FMS ì„œë²„ë¡œ POST ìš”ì²­
3.  **FMS**:
    - ë¬¼ë¦¬ íŒŒì¼ ì €ì¥ (`/storage/uuid.jpg`)
    - DB ê¸°ë¡ (UUID ìƒì„±)
    - ê²°ê³¼ ì‘ë‹µ (`{ file_uuid: 'ABC-123' }`)
4.  **Front**: ë°˜í™˜ëœ UUIDë¥¼ ê²Œì‹œê¸€ í¼ì˜ hidden inputì— ì €ì¥
5.  **ì‚¬ìš©ì**: ê²Œì‹œê¸€ ì €ì¥ ë²„íŠ¼ í´ë¦­
6.  **Main DB**: ê²Œì‹œê¸€ ë°ì´í„°ì™€ í•¨ê»˜ `file_uuid`('ABC-123')ê°€ ì €ì¥ë¨

---

## â˜• 7. ë°±ì—”ë“œ ì£¼ìš” ìë°” ì½”ë“œ ë¶„ì„ (Deep Dive)

ìë°” ë°±ì—”ë“œ ë¡œì§ì´ ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ ìˆëŠ”ì§€ ì†ŒìŠ¤ ì½”ë“œ ë‹¨ìœ„ë¡œ ìƒì„¸íˆ ë¶„ì„í•©ë‹ˆë‹¤.

### 7.1 FileManagerController - ì—…ë¡œë“œ ì§„ì…ì 

```java
@PostMapping("/upload")
public List<Map<String, Object>> uploadFile(@RequestParam("folder_name") String folder_name,
        @RequestParam(value = "file_uuid", required = false) String file_uuid,
        @RequestParam("files") MultipartFile[] files) throws Exception {
    // 1. í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚¸ í´ë”ëª…, ê¸°ì¡´ UUID(ì˜µì…˜), íŒŒì¼ ëª©ë¡ì„ ì„œë¹„ìŠ¤ë¡œ ë„˜ê¹ë‹ˆë‹¤.
    List<Map<String, Object>> map = fileManagerService.fileUpload(folder_name, file_uuid, files);
    return map;
}
```
- **ì—­í• **: ë©€í‹°íŒŒíŠ¸ ìš”ì²­(`MultipartFile[]`)ì„ ìˆ˜ì‹ í•˜ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.

---

### 7.2 FileManagerService - ì—…ë¡œë“œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

```java
public List<Map<String, Object>> fileUpload(String folder_name, String file_uuid, MultipartFile[] files) throws Exception {
    // 1. UUID ê²°ì •: ìˆìœ¼ë©´(ìˆ˜ì •) ì‚¬ìš©, ì—†ìœ¼ë©´(ì‹ ê·œ) ìƒì„±
    String uid = (file_uuid != null && !file_uuid.isEmpty()) ? file_uuid : String.valueOf(UUID.randomUUID());
    
    // 2. ë¬¼ë¦¬ íŒŒì¼ ì €ì¥ ìˆ˜í–‰ (ë¶€ëª¨ í´ë˜ìŠ¤ í˜¸ì¶œ)
    List<Map<String, Object>> result = uploadFile(folder_name, files);
    
    // 3. ê¸°ë¡ ì¤€ë¹„: ëª¨ë“  íŒŒì¼ì— ë™ì¼í•œ file_uuid ë¶€ì—¬ (1:N ê´€ê³„ í˜•ì„±)
    for (Map<String, Object> list : result) {
        list.put("file_uuid", uid);
    }

    if (!result.isEmpty()) {
        // 4. SYS_FILE ë§ˆìŠ¤í„° í…Œì´ë¸” ê¸°ë¡ (ê¸°ì¡´ì— ì—†ì„ ë•Œë§Œ ì‹ ê·œ ìƒì„±)
        if (isNewUuid(uid)) {
            var sysFile = SysFile.builder().file_uuid(uid).temp_yn(0).build();
            sysFileMapper.SYS_FILE_INSERT(sysFile);
        }
        return result;
    }
    return null;
}
```
- **í•µì‹¬**: ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ì´ ì˜¬ë¼ì˜¤ë”ë¼ë„ í•˜ë‚˜ì˜ `file_uuid`ë¡œ ë¬¶ì–´ì£¼ëŠ” **ê·¸ë£¹í•‘(Grouping)** ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

### 7.3 FileProcessManager - ë¬¼ë¦¬ì  ì €ì¥ ìˆ˜í–‰

```java
@Override
public List<Map<String, Object>> uploadFile(String folder_name, MultipartFile[] files) throws IOException {
    // 1. ì €ì¥ ê²½ë¡œ ì„¤ì • (base path + folder_name)
    String directoryPath = getDirectoryPath(folder_name);
    makeDirectory(directoryPath); // í´ë”ê°€ ì—†ìœ¼ë©´ ìƒì„±

    List<Map<String, Object>> result = new ArrayList<>();
    for (MultipartFile file : files) {
        if (!file.isEmpty()) {
            // 2. íŒŒì¼ë³„ ê³ ìœ  ID(file_id) ìƒì„± (DB ì €ì¥ìš©)
            UUID fileId = UUID.randomUUID();
            
            // 3. ë¬¼ë¦¬ ì €ì¥: í•˜ë“œë””ìŠ¤í¬ì—ëŠ” "file_id.í™•ì¥ì"ë¡œ ì €ì¥ (ì¤‘ë³µ ë°©ì§€)
            String ext = getExtension(file.getOriginalFilename());
            File uploadFile = new File(directoryPath + File.separator + fileId + "." + ext);
            file.transferTo(uploadFile);

            // 4. ì €ì¥ëœ ì •ë³´ë¥¼ Mapì— ë‹´ì•„ ë°˜í™˜ (ë‚˜ì¤‘ì— DB Insertë¥¼ ìœ„í•¨)
            Map<String, Object> map = new HashMap<>();
            map.put("file_path", directoryPath);
            map.put("file_id", String.valueOf(fileId));
            map.put("file_name", file.getOriginalFilename());
            result.add(map);
        }
    }
    return result;
}
```
- **í•µì‹¬**: ì‚¬ìš©ìê°€ ì˜¬ë¦° ì‹¤ì œ íŒŒì¼ëª…ì„ ê·¸ëŒ€ë¡œ ì“°ì§€ ì•Šê³  `UUID`ë¡œ ë³€ê²½í•˜ì—¬ ì €ì¥í•¨ìœ¼ë¡œì¨ **íŒŒì¼ëª… ì¶©ëŒ ë° ë³´ì•ˆ ë¬¸ì œ**ë¥¼ ì›ì²œ ì°¨ë‹¨í•©ë‹ˆë‹¤.

---

### 7.4 FileManagerController - ë‹¤ìš´ë¡œë“œ ì§„ì…ì 

```java
// [íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸]
@GetMapping("/download")
public void downloadFile(@RequestParam("fileId") String fileId, HttpServletResponse response) throws Exception {
    // ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë°›ì€ fileIdë¥¼ ì„œë¹„ìŠ¤ ë ˆì´ì–´ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
    fileManagerService.fileDownload(fileId, response);
}
```
- **ì—­í• **: í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ í•´ì„í•˜ê³ , ì„œë¹„ìŠ¤ ë ˆì´ì–´ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìœ„ì„í•©ë‹ˆë‹¤.
- **íŠ¹ì§•**: ë‹¤ìš´ë¡œë“œëŠ” íŒŒì¼ì„ ì§ì ‘ ë°”ì´íŠ¸ë¡œ ìŸì•„ë‚´ì•¼ í•˜ë¯€ë¡œ ë°˜í™˜ íƒ€ì…ì´ `void`ì´ë©° `HttpServletResponse` ê°ì²´ë¥¼ ì§ì ‘ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

### 7.2 FileManagerService - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (Orchestrator)

ì‹¤ì œ "ì •ì±…"ì„ ê²°ì •í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. (DB ì €ì¥ ì—¬ë¶€, UUID ìƒì„± ë“±)

```java
// [ë‹¤ìš´ë¡œë“œ ì •ë³´ ì¤€ë¹„]
public void fileDownload(String file_id, HttpServletResponse response) throws Exception {
    // 1. DBì—ì„œ íŒŒì¼ì˜ ì›ë³¸ëª…, ì €ì¥ ê²½ë¡œ ë“± ë©”íƒ€ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
    SysFileDetail searchParam = new SysFileDetail();
    searchParam.setFile_id(file_id);
    List<SysFileDetail> details = sysFileDetailMapper.SELECT(searchParam);

    if (details != null && !details.isEmpty()) {
        SysFileDetail detail = details.get(0);
        // 2. ë¶€ëª¨ í´ë˜ìŠ¤(FileProcessManager)ì˜ ë¬¼ë¦¬ íŒŒì¼ ìŠ¤íŠ¸ë¦¬ë° ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ Mapì— ë‹´ìŠµë‹ˆë‹¤.
        Map<String, Object> param = new HashMap<>();
        param.put("file_path", detail.getFile_path());
        param.put("file_id", detail.getFile_id());
        param.put("file_name", detail.getFile_name());
        param.put("file_extension", detail.getFile_extension());

        downloadFile(param, response);
    } else {
        // íŒŒì¼ ì •ë³´ê°€ DBì— ì—†ìœ¼ë©´ 404 ì—ëŸ¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        response.setStatus(HttpServletResponse.SC_NOT_FOUND);
    }
}
```
- **ì—­í• **: í•˜ë“œë””ìŠ¤í¬ì— íŒŒì¼ì´ ì–´ë”” ìˆëŠ”ì§€ DBì—ì„œ ë¨¼ì € ì°¾ì•„ë‚¸ ë’¤, ì‹¤ì œ íŒŒì¼ì„ ì „ì†¡í•  ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤.

---

### 7.3 FileProcessManager - ë¬¼ë¦¬ì  ì²˜ë¦¬ (Low-level Engine)

íŒŒì¼ ì‹œìŠ¤í…œ(I/O)ê³¼ ì§ì ‘ í†µì‹ í•˜ëŠ” í•˜ìœ„ ì—”ì§„ì…ë‹ˆë‹¤.

```java
// [íŒŒì¼ ë¬¼ë¦¬ ìŠ¤íŠ¸ë¦¬ë° ë° ë‹¤ìš´ë¡œë“œ]
@Override
public void downloadFile(Map<String, Object> param, HttpServletResponse response) throws IOException {
    String filePath = (String) param.get("file_path");
    String fileId = (String) param.get("file_id");
    String extension = (String) param.get("file_extension");
    String originalFileName = (String) param.get("file_name");

    // 1. ë¬¼ë¦¬ íŒŒì¼ ê²½ë¡œ ì¡°í•© (ì €ì¥ ì‹œ UUID.ext ë¡œ ì €ì¥í–ˆìœ¼ë¯€ë¡œ ì´ë¥¼ ì°¾ìŠµë‹ˆë‹¤)
    String physicalFileName = fileId + (extension != null && !extension.isEmpty() ? "." + extension : "");
    Path path = Paths.get(filePath, physicalFileName);
    File file = path.toFile();

    if (file.exists()) {
        // 2. [ë§¤ìš° ì¤‘ìš”] í•œê¸€ íŒŒì¼ëª… ê¹¨ì§ ë°©ì§€ ì¸ì½”ë”©
        String encodedFileName = URLEncoder.encode(originalFileName, StandardCharsets.UTF_8).replaceAll("\\+", "%20");
        
        // 3. ë¸Œë¼ìš°ì € ì‘ë‹µ í—¤ë” ì„¤ì •
        response.setHeader("Content-Disposition", "attachment; filename=\"" + encodedFileName + "\"");
        response.setContentType("application/octet-stream");
        response.setContentLength((int) file.length());

        // 4. íŒŒì¼ì„ ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ì½ì–´ì„œ ì‘ë‹µ ë³¸ë¬¸ì— ìŸì•„ë¶“ìŠµë‹ˆë‹¤ (Streaming)
        try (InputStream inputStream = new FileInputStream(file)) {
            StreamUtils.copy(inputStream, response.getOutputStream());
            response.flushBuffer(); // ë²„í¼ë¥¼ ë¹„ì›Œ ì „ì†¡ì„ ì™„ë£Œí•©ë‹ˆë‹¤.
        }
    }
}
```
- **ì—­í• **: ì‹¤ì œ íŒŒì¼ì„ ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ìª¼ê°œì–´ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì‚¬ìš©ì ì»´í“¨í„°ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
- **í¬ì¸íŠ¸**: `StreamUtils.copy`ëŠ” ë©”ëª¨ë¦¬ ë¶€í•˜ë¥¼ ì¤„ì´ë©´ì„œ íŒŒì¼ì„ ì „ì†¡í•˜ëŠ” íš¨ìœ¨ì ì¸ ë°©ì‹ì…ë‹ˆë‹¤.

---

## ğŸ’¡ 8. ë…í•™ í¬ì¸íŠ¸ (Self-Study Tips)

1.  **UUIDì˜ ì—­í• **: íŒŒì¼ëª… ëŒ€ì‹  UUIDë¥¼ ì™œ ì‚¬ìš©í•˜ëŠ”ì§€ ê³ ë¯¼í•´ë³´ì„¸ìš”. (ë³´ì•ˆ, íŒŒì¼ëª… ì¤‘ë³µ ë°©ì§€)
2.  **ë©€í‹°íŒŒíŠ¸(Multipart)**: ì¼ë°˜ JSON ë°ì´í„° ì „ì†¡ê³¼ ë°”ì´ë„ˆë¦¬ íŒŒì¼ ì „ì†¡ì˜ ì°¨ì´ì ì„ ê³µë¶€í•´ë³´ì„¸ìš”.
3.  **ìŠ¤íŠ¸ë¦¬ë°(Streaming)**: ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ í•œ ë²ˆì— ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ì§€ ì•Šê³  ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì˜ëŠ” ì´ìœ ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

ì´ êµ¬ì¡°ëŠ” í™•ì¥ì„±ì´ ë§¤ìš° ë›°ì–´ë‚˜ì„œ, ë‚˜ì¤‘ì— AWS S3 ê°™ì€ í´ë¼ìš°ë“œ ì €ì¥ì†Œë¡œ ë°”ê¾¸ë”ë¼ë„ ë°±ì—”ë“œì˜ `FileProcessManager` ë¡œì§ë§Œ ìˆ˜ì •í•˜ë©´ UIëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.
